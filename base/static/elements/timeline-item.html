<link rel="import" href="../bower/polymer/polymer.html">
<link rel="import" href="../bower/paper-shadow/paper-shadow.html">

<polymer-element name="timeline-item" attributes="date color count">
    <template>
        <link rel="stylesheet" href="../css/groups.css">

        <style>
            :host {
                width: 0px;
                height: 0px;
                position: absolute;
                top: 4px; /* half timeline-line.bar.height */
                z-index:2;
            }

            :host, .bubble {
                margin: 0 0;
                padding: 0;
            }

            .bubble {
                width: 48px;
                height: 48px;
                margin: -24px;
                display: block;
                border-radius: 50%;
                -webkit-transition: width .2s, height .2s, margin .2s, font-size .2s;
                transition: width .2s, height .2s, margin .2s, font-size .2s;
            }

            .bubble.highlighted {
                width: 64px;
                height: 64px;
                margin: -32px;
                font-size: 21px;
            }
            .bubble .badge {
                position: absolute;
                top: 0px;
                right: 0px;
                width: 24px;
                height: 24px;
                background-color: #F44336;
                color: white;
                border-radius: 50%;
                margin: -8px;

                -webkit-transition: width .2s, height .2s, margin .2s;
                transition: width .2s, height .2s, margin .2s;
            }

            .bubble.highlighted .badge {
                width: 32px;
                height: 32px;
                margin: -11px;
            }


        </style>
        <paper-shadow z="1" id="bubble" class="group-{{ color }} bubble" on-tap="{{ tap }}" horizontal layout center>
            <div flex vertical layout center>
                {{ day }}
            </div>
            <template if="{{ count > 1 }}">
                <paper-shadow class="badge" horizontal layout center>
                    <div flex vertical layout center>
                        {{ count }}
                    </div>
                </paper-shadow>
            </template>
        </paper-shadow>
    </template>
    <script>
        Polymer('timeline-item', {
            color: 'grey',
            day: 0,
            date: 0,
            timeSpanStart: 0,
            timeSpanEnd: 0,
            lineWidth: 0,
            timeSpanStartChanged: function () {
                this.update();
            },
            timeSpanEndChanged: function () {
                this.update();
            },
            dateChanged: function () {
                this.update();
            },
            lineWidthChanged: function () {
                this.update();
            },
            update: function () {
                var percentage = (this.date - this.timeSpanStart) / (this.timeSpanEnd - this.timeSpanStart);
                this.style.left = Math.round(percentage * this.lineWidth) + 'px';

                this.day = new Date(this.date * 1000).getDate();
            },
            ready: function () {
                this.update();
            },
            tap: function () {
                    this.open();
            },
            open: function () {
                this.fire('item-open');
                this.$.bubble.classList.add('highlighted');
            },
            close: function () {
                this.$.bubble.classList.remove('highlighted');
            }
        });
    </script>

</polymer-element>