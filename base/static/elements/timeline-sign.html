<link rel="import" href="../bower/polymer/polymer.html">
<link rel="import" href="../bower/paper-shadow/paper-shadow.html">

<polymer-element name="timeline-sign" attributes="date visible tiny">
    <template>
        <link rel="stylesheet" href="../css/groups.css">

        <style>
            :host {
                bottom: 0px;
                margin: 0 0;
                padding: 0;
                z-index: 3;
            }

            :host, .container {
                width: 0px;
                height: 0px;
                position: absolute;
            }

            .container {
                margin-top: -50px;
                margin-left: 0px;
                z-index: 2;
                transition: margin-top .2s;
                -webkit-transition: margin-top .2s;
            }
            .container[visible] {
                margin-top: -140px;
            }
            .container[tiny][visible] {
                margin-top: -75px;
            }

            .container > em {
                padding: 0 5px;
                opacity: 0;
                transition: opacity .1s ease-in-out;
                -webkit-transition: opacity .1s ease-in-out;
                font-weight: 100;
                font-size: 36px
            }
            .container[tiny] > em {
                font-size: 24px;
            }
            .container[visible] > em {
                opacity: 1;
            }

            .container:after {
                content: '';
                display: block;
                width: 1px;
                height: 42px;
                background-color: #979797;
                position: absolute;
                right: 0px;
                top: 0px;
                margin-top: 0px;
                margin-right: 0px;
                z-index: -1;

                transition: height .2s;
                -webkit-transition: height .2s;
            }
            .container[visible]:after {
                height: 132px;
            }
            .container[tiny][visible]:after {
                height: 67px;
            }
        </style>
        <div class="container" visible?="{{ visible }}" tiny?="{{ tiny }}">
            <em>
                <content></content>
            </em>
        </div>
    </template>
    <script>
        Polymer('timeline-sign', {
            date: 0,
            visible: false,
            forced: false,
            tiny: false,
            forcedLocation: 0,
            timeSpanStart: 0,
            timeSpanEnd: 0,
            lineWidth: 0,
            timeSpanStartChanged: function () {
                this.update();
            },
            timeSpanEndChanged: function () {
                this.update();
            },
            dateChanged: function () {
                this.update();
            },
            lineWidthChanged: function () {
                this.update();
            },
            forcedChanged: function () {
                this.update();
            },
            forcedLocationChanged: function () {
                this.update();
            },
            getLocation: function() {
                var percentage = (this.date - this.timeSpanStart) / (this.timeSpanEnd - this.timeSpanStart);
                return Math.round(percentage * this.lineWidth);
            },
            update: function () {
                this.style.left = this.forced ? this.forcedLocation + 'px' : this.getLocation() + 'px';
                this.day = new Date(this.date * 1000).getDate();
            },
            ready: function () {
                this.update();
            }
        });
    </script>

</polymer-element>